<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Numbers</title>
  <script src="levels.js"></script>
  <script src="canvasUtil.js"></script>
  <script src="flamingo.js"></script>
  <style>
    body{margin:0px;padding:0px;}
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>
<div id="main">
  <div id="content">
    <canvas id="canvas"></canvas>
  </div>
</div>
  <script>
  var GAME=0;
  var GAMEOVER=1;
  var MENU=2;
  var LEVEL_INTRO=3
  var BATTLESUMMARY=4

  var ENDLESS=0
  var PUZZLE=1
  var TIMED=2
  var LIMITED=3
  var BATTLE=4

  var gameType=PUZZLE
  var currentLevel=0
  var currentStriped=0

  var engine=CreateEngine({
    fps:30,
    width:750,
    height:1334
  });

  // engine.loadImage("background","images/background_2.png");
  engine.loadImage("menu_button","images/menu_button.png");

  engine.loadImage("piece_1","images/piece_1.png");
  engine.loadImage("piece_2","images/piece_2.png");
  engine.loadImage("piece_3","images/piece_3.png");
  engine.loadImage("piece_4","images/piece_4.png");
  engine.loadImage("piece_5","images/piece_5.png");
  engine.loadImage("piece_6","images/piece_6.png");
  engine.loadImage("piece_7","images/piece_7.png");
  engine.loadImage("piece_8","images/piece_8.png");
  engine.loadImage("piece_x2","images/piece_x2.png");
  engine.loadImage("piece_x3","images/piece_x3.png");
  engine.loadImage("piece_x4","images/piece_x4.png");
  engine.loadImage("piece_bomb_side","images/piece_bomb_side.png");
  engine.loadImage("piece_bomb_all","images/piece_bomb_all.png");
  engine.loadImage("piece_shuffle","images/piece_shuffle.png");
  engine.loadImage("piece_locked","images/piece_locked.png");
  engine.loadImage("rock","images/rock.png");

  engine.loadImage("robot_1_1","images/robot_1_1.png");
  engine.loadImage("robot_1_2","images/robot_1_2.png");
  engine.loadImage("robot_1_3","images/robot_1_3.png");

  engine.addScene("profile",{
    dirty:0,
    click:function(x,y){
      if(y>engine.config("height")-400+20 && y<engine.config("height")-400+20+150){
        // back
        engine.showScene("main-menu")
      }
      this.dirty=0
    },
    render:function(ctx){
      if(this.dirty==0){
        // Background
        ctx.fillStyle="#AAAAAA";
        ctx.fillRect(0,0,engine.config("width"),engine.config("height"));

        
        ctx.fillStyle="rgba(0,0,0,0.6)";
        ctx.fillRect(20,engine.config("height")-400+20,engine.config("width")-40,150);
        
        ctx.font="80px helvetica";
        ctx.textAlign="center";
        ctx.fillStyle="#FFFFFF";
        ctx.fillText("Profile!",engine.config("width")/2,100);
 
        ctx.fillText("back",engine.config("width")/2,engine.config("height")-300+20);

        this.dirty=16
      }
      this.dirty--
    }
  })

  engine.addScene("main-menu",{
    dirty:0,
    roboFrame:1,
    click:function(x,y){
      if(y>engine.config("height")-400+20 && y<engine.config("height")-400+20+150){
        // Battle
        gameType=BATTLE
        engine.showScene("game")
      }else if(y>engine.config("height")-400+20+150){
        if(x<20+(engine.config("width")-80)/3+20){
          // Puzzle
          gameType=PUZZLE
          currentLevel=0
          engine.showScene("game")
        }else if(x<20+((engine.config("width")-80)/3)*2+40){
          // Endless
          gameType=ENDLESS
          engine.showScene("game")
        }else{
          // Profile
          engine.showScene("profile")
        }
      }
      this.dirty=0
    },
    render:function(ctx){
      if(this.dirty==0){
        // Background
        ctx.fillStyle="#BBCCFF";
        ctx.fillRect(0,0,engine.config("width"),engine.config("height"));

        if(this.roboFrame>3){
          ctx.drawImage(engine.image("robot_1_"+(6-this.roboFrame)),engine.config("width")/2-100,engine.config("height")-800);
        }else{
          ctx.drawImage(engine.image("robot_1_"+this.roboFrame),engine.config("width")/2-100,engine.config("height")-800);
        }

        // Menu Background
        ctx.fillStyle="#FFAA00";
        ctx.fillRect(0,engine.config("height")-400,engine.config("width"),400);

        ctx.fillStyle="rgba(0,0,0,0.6)";
        ctx.fillRect(20,engine.config("height")-400+20,engine.config("width")-40,150);
        ctx.fillRect(20,engine.config("height")-400+20+150+20,(engine.config("width")-80)/3,150);
        ctx.fillRect(20+(engine.config("width")-80)/3+20,engine.config("height")-400+20+150+20,(engine.config("width")-80)/3,150);
        ctx.fillRect(20+((engine.config("width")-80)/3)*2+40,engine.config("height")-400+20+150+20,(engine.config("width")-80)/3,150);

        ctx.font="80px helvetica";
        ctx.textAlign="center";
        ctx.fillStyle="#FFFFFF";
        ctx.fillText("Super Robot",engine.config("width")/2,100);
        ctx.fillText("Number Game",engine.config("width")/2,200);

        ctx.fillText("Battle",engine.config("width")/2,engine.config("height")-300+20);

        ctx.font="50px helvetica";
        ctx.fillText("Puzzle",20+((engine.config("width")-80)/3)/2,engine.config("height")-400+280);
        ctx.fillText("Endless",engine.config("width")/2,engine.config("height")-400+280);
        ctx.fillText("Profile",60+((engine.config("width")-80)/3)*2+((engine.config("width")-80)/3)/2,engine.config("height")-400+280);

        ctx.font="30px helvetica";
        ctx.fillStyle="rgba(0,0,0,0.2)";
        ctx.fillText("(c) 2015 - Fabulous Flamingo",engine.config("width")/2,engine.config("height")-20);
        this.dirty=30
        this.roboFrame++
        if(this.roboFrame==5){
          this.roboFrame=1
        }
      }
      this.dirty--
    }
  });

  // localStorage["numbers-hiscore"]=0;
  engine.addScene("game",{
    mode:GAME,
    hiscore:0,
    score:0,
    blockWidth:120,
    blockHeight:120,
    yOffset:240,
    xOffset:20,
    columns:6,
    rows:9,
    largestPiece:4,
    frameTime:1000/30,
    blocks:[],
    colors:[],
    lastNumber:0,
    dirty:0,

    stealthScore:0,
    attackScore:0,
    defenseScore:0,
    startTime:0,

    enter:function(){      
      // setup blocks
      for(var i=0;i<this.columns*this.rows;i++){
        this.blocks.push({
          number:-1,
          locked:false
        });
      }
      // setup colors
      for(var i=0;i<5;i++){
        this.colors.push("rgb("+(50+i*40)+",200,"+(250-i*40)+")");
      }
      for(var i=0;i<5;i++){
        this.colors.push("rgb(250,"+(200-i*40)+",50)");
      }
      for(var i=0;i<5;i++){
        this.colors.push("rgb(250,0,"+(50+i*40)+")");
      }
      this.restartGame()
    },
    multiplier:1,
    markCount:0,
    getNewBlockType:function(){
      if(this.lastNumber==4){
        this.lastNumber=0;
        if(Math.random()<0.3)return 10000;
        if(Math.random()<0.3)return 10001;
        return 10002;
      }else if(this.lastNumber>=5){
        this.lastNumber=0;
        if(Math.random()<0.3)return 10010;
        if(Math.random()<0.3)return 10011;
        return 10012;
      }
      this.lastNumber=0;
      return Math.floor(Math.random()*4+1);
    },
    traverse:function (x,y,number){
      if(x<0 || x>=this.columns)return;
      if(y<0 || y>=this.rows)return;
      var b=this.blocks[x+y*this.columns];
      if((b.number==number || (b.number>=10000 && b.number<10010)) && !b.mark){
        if(b.number==10000)this.multiplier*=2;
        if(b.number==10001)this.multiplier*=3;
        if(b.number==10002)this.multiplier*=4;
        b.mark=true;
        this.markCount++;
        this.traverse(x-1,y,number);
        this.traverse(x+1,y,number);
        this.traverse(x,y-1,number);
        this.traverse(x,y+1,number);
      }
    },
    countStriped:function(){
      var striped=0
      for(var iy=0;iy<this.rows;iy++){
        for(var ix=0;ix<this.columns;ix++){
          if(this.blocks[ix+iy*this.columns].locked){
            striped++
          }
        }
      }
      currentStriped=striped
    },
    fillEmptyBlocks:function(){
      var fill=0;
      for(var i=0;i<this.columns;i++){
        if(this.blocks[i].number==-1){
          this.blocks[i].number=this.getNewBlockType();
          fill++;
        }
      }
      if(fill>0){
        this.scheduleFunction(this.frameTime,this.collapseBlocks);
      }else{
        if(this.couldCollapse()){
          this.scheduleFunction(this.frameTime,this.collapseBlocks);
        }else{
          // this should be the end of a change loop, check for gameover
          if(gameType==PUZZLE && currentStriped==0){
            this.levelUp()
          }else{
            this.scheduleFunction(this.frameTime,this.checkGameOver);
          }
        }
      }
    },
    couldCollapse:function(){
      for(var ix=0;ix<this.columns;ix++){
          for(var iy=this.rows-1;iy>0;iy--){
            var b=this.blocks[ix+iy*this.columns];
            if(b.number==-1){
              var b2=this.blocks[ix+(iy-1)*this.columns];
              if(b2.number>0){
                return true
              }
            }
          }
        }
        return false
    },
    collapseBlocks:function(){
      var swapped=false;
      for(var ix=0;ix<this.columns;ix++){
          for(var iy=this.rows-1;iy>0;iy--){
            var b=this.blocks[ix+iy*this.columns];
            if(b.number==-1){
              var b2=this.blocks[ix+(iy-1)*this.columns];
              if(b2.number>0){
                this.blocks[ix+iy*this.columns]=b2;
                this.blocks[ix+(iy-1)*this.columns]=b;
                swapped=true;
              }
            }
          }
        
      } 

      if(swapped){
        for(var i=0;i<this.columns;i++){
          if(this.blocks[i].number==-1){
            this.blocks[i].number=this.getNewBlockType();
          }
        }
        // this.fillEmptyBlocks()
        this.scheduleFunction(this.frameTime,this.collapseBlocks);
        return true
      }else{
        this.scheduleFunction(this.frameTime,this.fillEmptyBlocks);
        return false
      }
    },
    checkGameOver:function(){
      for(var iy=0;iy<this.rows;iy++){
        for(var ix=0;ix<this.columns;ix++){
          if(this.blocks[ix+iy*this.columns].number>=10010){
            return false;
          }
          this.markCount=0;
          if(this.blocks[ix+iy*this.columns].number>0){
            for(var i=0;i<this.blocks.length;i++){
              this.blocks[i].mark=false;
            }
            this.traverse(ix,iy,this.blocks[ix+iy*this.columns].number);
            if(this.markCount>2){
              return false;
            }
          }
        }
      }
      if(gameType==BATTLE){
        // this.shuffleBoard()
        this.scheduleFunction(this.frameTime,this.shuffleBoard);
        this.addBonusText("No more moves - shuffle!");
        return false
      }else{
        this.mode=GAMEOVER;
        return true;
      }
    },
    addScore:function(scoreAdd){
      this.score+=scoreAdd;
      if(this.score>this.hiscore  && this.score<10000000){
        this.hiscore=this.score;
        localStorage["numbers-hiscore"+gameType+"-"+currentLevel]=this.hiscore;
      }
    },
    blockClicked: function(x,y){
      this.multiplier=1;
      for(var i=0;i<this.blocks.length;i++){
        this.blocks[i].mark=false;
      }
      var num=this.blocks[x+y*this.columns].number;
      if(num<=0){
        return;
      }else if(num==10010){
        // new style bomb
        this.explodeSideBomb(x,y);
        this.addScore(250);
        this.addBonusText("Blow away row, 250 points");
        this.scheduleFunction(this.frameTime,this.collapseBlocks);
        return;
      }else if(num==10011){
        // bomb
        this.explodeBomb(x,y);
        this.addScore(500);
        this.addBonusText("Blow away double, 500 points");
        this.scheduleFunction(this.frameTime,this.collapseBlocks);
        return;
      }else if(num==10012){
        // shuffle
        this.shuffleBoard(x,y)
        this.addScore(100);
        this.addBonusText("Shuffle board, 100 points");
        this.scheduleFunction(this.frameTime,this.collapseBlocks);
      }else if(num>=10000){
        // For now just return
        return;
      }
      this.markCount=0;
      this.traverse(x,y,num);
      if(this.markCount>2){
        this.lastNumber=num;
        for(var i=0;i<this.blocks.length;i++){
          if(this.blocks[i].mark){
            this.blocks[i].number=-1;
            this.blocks[i].locked=false;
            this.addScore(num*this.multiplier);
          }
        }
        this.countStriped()
        this.scheduleFunction(this.frameTime,function(){
          this.blocks[x+y*this.columns].number=num+1;
          if(gameType==BATTLE){
            if(num==2){
              // this.attackScore+=num*this.markCount*this.multiplier
            }else if(num==3){
              this.attackScore+=num*this.markCount*this.multiplier
            }else if(num==4){
              this.defenseScore+=num*this.markCount*this.multiplier
            }else if(num==5){
              this.attackScore+=num*this.markCount*this.multiplier*10
            }else if(num==6){
              this.stealthScore+=num*this.markCount*this.multiplier*10
            }
          }else{
            if(num+1>this.largestPiece){
              this.largestPiece=num+1;
              this.addScore(this.largestPiece*this.largestPiece);
              this.addBonusText("New piece "+this.largestPiece+", "+this.largestPiece*this.largestPiece+" points");
            }
            if(this.markCount>=15){
              this.addScore(250);
              this.addBonusText("15+ Group, 250 points");
            }else if(this.markCount>=10){
              this.addScore(100);
              this.addBonusText("10+ Group, 100 points");
            }else if(this.markCount>=5){
              this.addScore(25);
              this.addBonusText("5+ Group, 25 points");
            }
          }
          this.scheduleFunction(this.frameTime,this.collapseBlocks);
        });

      }
    },
    explodeBomb:function(x,y){
      var queue=new Array();

      for(var ix=0;ix<this.columns;ix++){
        var b=this.blocks[ix+y*this.columns];
        if(b.number>0){
          if((b.number==10010 || b.number==10011)&& ix!=x){
            queue.push({
              x:ix,y:y,number:b.number
            });
          }
          b.number=-1
          b.locked=false
        }
      }
      for(var iy=0;iy<this.rows;iy++){
        var b=this.blocks[x+iy*this.columns];
        if(b.number>0){
          if((b.number==10010 || b.number==10011)&& iy!=y){
            queue.push({
              x:x,y:iy,number:b.number
            });
          }
          b.number=-1;
          b.locked=false
        }
      }
      for(var i=0;i<queue.length;i++){
        var b=queue[i];
        if(b.number==10011){
          this.explodeBomb(queue[i].x,queue[i].y);
        }else if(b.number==10010){
          this.explodeSideBomb(queue[i].x,queue[i].y);
        }
      }
    },
    shuffleBoard:function(x,y){
      if(x!=null){
        this.blocks[x+y*this.columns].number=this.getNewBlockType();
      }
      var currentIndex = this.columns*this.rows-1, temporaryValue, randomIndex ;

      // While there remain elements to shuffle...
      while (0 !== currentIndex) {

        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;

        // And swap it with the current element.
        temporaryValue = this.blocks[currentIndex];
        if(temporaryValue.number>0){
          this.blocks[currentIndex] = this.blocks[randomIndex];
          this.blocks[randomIndex] = temporaryValue;
        }
      }
      this.dirty=0
    },
    explodeSideBomb:function(x,y){
      for(var ix=0;ix<this.columns;ix++){
        var b=this.blocks[ix+y*this.columns];
        if(b.number>0){
          b.number=-1;
          b.locked=false
        }
      }
    },
    click:function(x,y){
      if(this.mode==GAME){
        var gap=this.yOffset;
        if(y>gap){
          var bx=Math.floor((x-this.xOffset)/this.blockWidth);
          var by=Math.floor((y-this.yOffset)/this.blockHeight);
          this.blockClicked(bx,by);
        }else{
          // menu button
          if(x>engine.config("width")-120 && y<120){
            this.mode=MENU
          }
        }
      }else if(this.mode==MENU){
        if(x>50 && x<engine.config("width")-100){
          if(y>325 && y<425){
            // Resume
            this.mode=GAME;
          }else if(y>475 && y<575){
            // Restart
            this.restartGame()
          }else if(y>625 && y<725){
            // Quit
            this.quitGame()
          }
        }
      }else if(this.mode==GAMEOVER){
        if(y>475 && y<575){
          // Restart
          this.restartGame()
        }else if(y>625 && y<725){
          // Quit
          this.quitGame()
        }
      }else if(this.mode=LEVEL_INTRO){
        if(y>625 && y<725){
          // Go
          this.mode=GAME
        }else if(y>775 && y<875){
          // Quit
          this.quitGame()
        }
      }
      dirty=0
    },
    levelUp:function(){
      currentLevel++
      this.restartGame()
    },
    quitGame:function(){
      engine.showScene("main-menu");
    },
    restartGame:function(){
      // load hiscore
      if(localStorage["numbers-hiscore"+gameType+"-"+currentLevel]==null){
        localStorage["numbers-hiscore"+gameType+"-"+currentLevel]=0;
        this.hiscore=0;
      }else{
        this.hiscore=parseInt(localStorage["numbers-hiscore"+gameType+"-"+currentLevel]);
      }
      this.runQueue=[]
      this.bonusQueue=[]
      /*var newBlocks=[]
      // setup blocks
      for(var i=0;i<this.columns*this.rows;i++){
        newBlocks.push({
          number:this.getNewBlockType()
        });
      }
      this.blocks=newBlocks*/
      for(var i=0;i<this.columns*this.rows;i++){
        this.blocks[i].number=-1
      }
      if(gameType==ENDLESS){     
        
      }else if(gameType==PUZZLE){
        var newBlocks=[]
        for(var i=0;i<this.columns*this.rows;i++){
          newBlocks.push({
            number:levelData[currentLevel].data[i].n,
            locked:levelData[currentLevel].data[i].l
          });
        }
        this.blocks=newBlocks
        this.countStriped()
      }
      this.scheduleFunction(this.frameTime,this.collapseBlocks);
      this.score=0
      this.dirty=0;

      this.stealthScore=0
      this.attackScore=0
      this.defenseScore=0

      this.startTime=new Date().getTime()

      if(gameType==PUZZLE){
        this.mode=LEVEL_INTRO
      }else{
        this.mode=GAME
      }
    },
    renderBlock:function(ctx,x,y,number){
      if(number==-1)return;
        var img_id="piece_1";
        if(number==0){
          img_id="rock"
          x-=5
          y-=5
        }else if(number==10000){
          img_id="piece_x2";
        }else if(number==10001){
          img_id="piece_x3";
        }else if(number==10002){
          img_id="piece_x4";
        }else if(number==10010){
          img_id="piece_bomb_side";
        }else if(number==10011){
          img_id="piece_bomb_all";
        }else if(number==10012){
          img_id="piece_shuffle";
        }else if(number<10){
          img_id="piece_"+number;
        }
        ctx.drawImage(engine.image(img_id),x,y);
     },
    runQueue:[],
    scheduleFunction:function(t,f){
      this.runQueue.push({
        time:Date.now()+t,
        exec:f
      });
    },
    bonusQueue:[],
    addBonusText:function(text){
      this.bonusQueue.push({text:text,time:2.0});
    },
    render:function(ctx){
      if(this.runQueue.length>0 || this.bonusQueue.length>0 || this.dirty==0){
        if(this.runQueue.length>0){
          if(this.runQueue[0].time<Date.now()){
            var job=this.runQueue.shift();
            job.exec.call(this);
          }
        }
        // Background
        ctx.fillStyle="#000000";
        ctx.fillRect(0,0,engine.config("width"),engine.config("height"));
        
        // menu button
        if(this.mode==GAME){
          ctx.drawImage(engine.image("menu_button"),engine.config("width")-120,20);
        }

        // Blocks
        for(var ix=0;ix<this.columns;ix++){
          for(var iy=0;iy<this.rows;iy++){
            this.renderBlock(ctx,ix*this.blockWidth+this.xOffset,iy*this.blockHeight+this.yOffset,this.blocks[ix+iy*this.columns].number);
            if(this.blocks[ix+iy*this.columns].locked && this.blocks[ix+iy*this.columns].number>-1){
              ctx.drawImage(engine.image("piece_locked"),ix*this.blockWidth+this.xOffset,iy*this.blockHeight+this.yOffset);

            }
          }
        }
        if(gameType!=BATTLE){
          // Score
          ctx.font="40px helvetica";
          ctx.textAlign="left";
          ctx.fillStyle="#FFFFFF";
          ctx.fillText(this.score,this.xOffset,160);
          ctx.font="20px helvetica";
          ctx.fillText("Score",this.xOffset,120);
          // hiscore
          ctx.font="40px helvetica";
          ctx.textAlign="left";
          ctx.fillStyle="#FFFFFF";
          ctx.fillText(this.hiscore,this.xOffset,80);
          ctx.font="20px helvetica";
          ctx.fillText("HiScore",this.xOffset,40);
        }

        if(gameType==PUZZLE){
          // Level
          ctx.font="40px helvetica";
          ctx.textAlign="left";
          ctx.fillStyle="#FFFFFF";
          ctx.fillText(currentLevel+1,this.xOffset+200,160);
          ctx.font="20px helvetica";
          ctx.fillText("Level",this.xOffset+200,120);
          // Striped
          ctx.font="40px helvetica";
          ctx.textAlign="left";
          ctx.fillStyle="#FFFFFF";
          ctx.fillText(currentStriped,this.xOffset+400,160);
          ctx.font="20px helvetica";
          ctx.fillText("Striped",this.xOffset+400,120);
        }else if(gameType==BATTLE){
          // Level
          ctx.font="50px helvetica";
          ctx.textAlign="center";
          ctx.fillStyle="#FFFFFF";
          var timeLeft=Math.floor(60-(((new Date().getTime())-this.startTime)/1000))
          if(timeLeft<0){
            timeLeft=0
            this.mode=BATTLESUMMARY
          }
          ctx.fillText(timeLeft,engine.config("width")/2,90);
          ctx.fillText(this.stealthScore,engine.config("width")/2+175,175);
          ctx.fillText(this.attackScore,engine.config("width")/2,175);
          ctx.fillText(this.defenseScore,engine.config("width")/2-175,175);

          ctx.font="30px helvetica";
          ctx.fillText("Time",engine.config("width")/2,45);
          ctx.fillText("Stealth",engine.config("width")/2+175,130);
          ctx.fillText("Attack",engine.config("width")/2,130);
          ctx.fillText("Defense",engine.config("width")/2-175,130);
        }

        if(this.bonusQueue.length>0){
          ctx.font="30px helvetica";
          ctx.textAlign="center";
          if(this.bonusQueue[0].time>1){
            ctx.fillStyle="#FFFFFF";
          }else{
            ctx.fillStyle="rgba(0,0,0,"+this.bonusQueue[0].time+")";
          }
          ctx.fillText(this.bonusQueue[0].text,engine.config("width")/2,220);
          this.bonusQueue[0].time-=0.025;
          if(this.bonusQueue[0].time<0.01){
            this.bonusQueue.shift();
          }
        }
        if(this.mode==GAMEOVER){
          ctx.fillStyle="rgba(0,0,0,0.6)";
          ctx.fillRect(0,0,engine.config("width"),engine.config("height"));
          ctx.fillRect(50,475,engine.config("width")-100,100);
          ctx.fillRect(50,625,engine.config("width")-100,100);
          
          ctx.font="80px helvetica";
          ctx.textAlign="center";
          ctx.fillStyle="#FFFFFF";
          ctx.fillText("Game Over!",engine.config("width")/2,300);
          ctx.fillText("Restart",engine.config("width")/2,550);
          ctx.fillText("Quit",engine.config("width")/2,700);

        }else if(this.mode==BATTLESUMMARY){
          ctx.fillStyle="rgba(0,0,0,0.6)";
          ctx.fillRect(0,0,engine.config("width"),engine.config("height"));
          
          ctx.font="80px helvetica";
          ctx.textAlign="center";
          ctx.fillStyle="#FFFFFF";
          ctx.fillText("Fight!",engine.config("width")/2,300);
          
        }else if(this.mode==MENU){
          ctx.fillStyle="rgba(0,0,0,0.6)";
          ctx.fillRect(0,0,engine.config("width"),engine.config("height"));
          ctx.fillRect(50,325,engine.config("width")-100,100);
          ctx.fillRect(50,475,engine.config("width")-100,100);
          ctx.fillRect(50,625,engine.config("width")-100,100);

          ctx.font="80px helvetica";
          ctx.textAlign="center";
          ctx.fillStyle="#FFFFFF";
          ctx.fillText("Resume",engine.config("width")/2,400);
          ctx.fillText("Restart",engine.config("width")/2,550);
          ctx.fillText("Quit",engine.config("width")/2,700);
        }else if(this.mode==LEVEL_INTRO){
          ctx.fillStyle="rgba(0,0,0,0.6)";
          ctx.fillRect(0,0,engine.config("width"),engine.config("height"));
          ctx.fillRect(50,625,engine.config("width")-100,100);
          ctx.fillRect(50,775,engine.config("width")-100,100);

          ctx.font="80px helvetica";
          ctx.textAlign="center";
          ctx.fillStyle="#FFFFFF";
          ctx.fillText("Level "+(currentLevel+1),engine.config("width")/2,400);
          ctx.font="40px helvetica";
          ctx.fillText(levelData[currentLevel].title,engine.config("width")/2,480);

          ctx.font="80px helvetica";
          ctx.fillText("Start",engine.config("width")/2,700);
          ctx.fillText("Quit",engine.config("width")/2,850);
        }

        this.dirty=16;
      }
      this.dirty--;
    }
  });
  engine.showScene("main-menu");
  engine.start();


  </script>
  <script>
  /*(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58519154-1', 'auto');
  ga('send', 'pageview');
*/
</script>
  </body>
</html>